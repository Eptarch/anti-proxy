# Anti-proxy

Сервис "анти-прокси", использующий сеть `tor` для доступа к отдельно указанным сайтам и сайтам с корневым доменом `.onion`.


### Кому это нужно

В основном, пользователям `OS Linux`, желающим избавиться от прокси-расширений для браузеров или самого браузера `tor`, отказаться от использования кнопки VPN браузера "Опера" (которая просто даёт вам какой-то неопознанный прокси-сервер) или унифицировать возможности доступа для домашней сети. 


### Как это работает

В одном контейнере - Socks5-прокси через сеть `tor`, к которой можно подключить любое приложение, поддерживающее указание Socks5-прокси (например, `Telegram`).
В другом - nginx-сервер, единственная цель которого - отдать PAC-файл (Proxy Auto Configuration), в котором указано для каких сайтов использовать прокси.


### Установка

Требуется `linux`, `make`<sup>[1](#footnote1)<a name="footnote1rev"></a></sup>, `docker` (в группе `sudo`), `docker-compose`.

В терминале пишем
```bash
git clone https://github.com/Eptarch/anti-proxy.git
cd anti-proxy
```

Открываем файл `proxy.pac` и через запятую пишем домены в строку `var whitelist = [ ]`, например, `var whitelist = [ "google.com", "yandex.ru" ]` (С оговоркой, что домены вы пишете свои - навряд ли вам понадобится ходить в Google или Яндекс через `tor` ;D )

Далее

```bash
make install
```

Если всё прошло хорошо - `docker ps` покажет два новых запущенных контейнера: `pac-nginx` и `tor-proxy`. Идём в настройки прокси-сервера в системе, и вставляем `http://127.0.0.1/proxy.pac` в строку "Use proxy auto configuration URL" ("Использовать URL автонастроки прокси"). Готово, теперь ваш браузер будет ходить через `tor` и по указанным в `proxy.pac` доменам и по доменам в сети `.onion`,

### Начинка

Контейнеры построены на `alpine:latest`, контейнер `tor-proxy` занимает приблизительно 20.7 Мб, контейнер `pac-nginx` - приблизительно 21.8 Мб

Если есть желание поставить на Raspberry Pi - имейте ввиду, что контейнеры доступны только с хоста, так как размечаются в `127.0.0.1`. Если хотите, чтобы можно было ходить в интернет через прокси, поставленный в __нелокальнную__ машину - замените `127.0.0.1:` на `0.0.0.0:` в файлах `pac-nginx.yml` и `tor-proxy.yml`. Кроме того, нужно заменить `127.0.0.1:9050` в файле `proxy.pac` на тот адрес, где у вас будет висеть контейнер `tor-proxy`.  Настройку https в nginx оставляю на вашу совесть, если вы собираетесь разместить этот контейнер во внешней сети.


_______

<a name="footnote1">[1](#footnote1rev)</a>: Можно без `make` и `sudo`, но тогда пишем руками `sudo docker-compose -f pac-nginx.yml -f tor-proxy.yml up -d --build`
